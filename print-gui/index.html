<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/custom.css">
  <link rel="icon" type="image/png" href="favicon.ico" />
  <!-- Esto aparece como t√≠tulo de la ventana o pesta√±a en el navegador: c√°mbialo -->
  <title>Print Manager GUI</title>
</head>

<body>
  <!-- Navs tabs-->
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <a class="navbar-brand" href="#">Printer Manager</a>
    <li class="nav-item">
      <a class="nav-link active" id="printers-tab" data-toggle="tab" href="#printers" role="tab"
        aria-controls="printers" aria-selected="true">Printers</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="groups-tab" data-toggle="tab" href="#groups" role="tab" aria-controls="groups"
        aria-selected="false">Groups</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="jobs-tab" data-toggle="tab" href="#jobs" role="tab" aria-controls="jobs"
        aria-selected="false">Jobs</a>
    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <!-- ##################################### PRINTERS ##################################### -->
    <div class="tab-pane fade show active" id="printers" role="tabpanel" aria-labelledby="home-tab">
      <div class="d-flex justify-content-center">
        <h1>Printers</h1>
      </div>
      <!-- Form filter printer -->
      <form class="filterBy" onsubmit="addNewPrinter()">
        <label>Filter by: </label>
        <div class="form-row">
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinterName" placeholder="Name">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinterModel" placeholder="Model">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinterStatus" placeholder="Status">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinterGroup" placeholder="Group">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinterIP" placeholder="ip">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinterLocation" placeholder="Location">
          </div>
          <div class="form-group col-md-1">
            <button type="submit" class="btn btn-primary">üîç</button>
          </div>
        </div>
      </form>
      <!-- Printers table -->
      <table id="printersTable" class="table">
          <!-- Table headers -->
          <!-- Table body -->
          <!-- Edit printer modal-->
          <!-- Delete printer modal -->
      </table>
      <!-- Add printer -->
      <div class="row">
        <div class="col-auto">
          <button type="button" class="btn btn-primary add-printer" data-toggle="modal" data-target="#addPrinterModal"
            data-toggle="tooltip" data-placement="top" title="add printer">
            ‚ûï
          </button>
        </div>
      </div>
    </div>
    <!-- Add printer modal-->
    <div id="addPrinterModal" class="modal fade" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add printer</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-row">
                <div class="form-group col-12">
                  <input type="text" class="form-control" name="printer-name" placeholder="Name">
                </div>
                <div class="form-group col-12">
                  <input type="text" class="form-control" name="printer-model" placeholder="Model">
                </div>
                <div class="form-group col-12">
                  <input type="text" class="form-control" name="printer-group" placeholder="Group">
                </div>
                <div class="form-group col-12">
                  <input type="text" class="form-control" name="printer-ip" placeholder="IP">
                </div>
                <div class="form-group col-12">
                  <input type="text" class="form-control" name="printer-location" placeholder="Location">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" onclick="addPrinter()" class="btn btn-primary">Add</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ##################################### GROUPS ##################################### -->
    <div class="tab-pane fade" id="groups" role="tabpanel" aria-labelledby="groups-tab">
      <div class="d-flex justify-content-center">
        <h1>Groups</h1>
      </div>
      <form class="filterBy">
        <label>Filter by: </label>
        <div class="form-row">
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputName" placeholder="Name">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputModel" placeholder="N¬∫printers">
          </div>
          <div class="form-group col-md-3">
            <input type="text" class="form-control" id="inputStatus" placeholder="Printers (P001, P002, ...)">
          </div>
          <div class="form-group col-md-1">
            <button type="button" class="btn btn-primary">üîç</button>
          </div>
        </div>
      </form>
      <table id="groupsTable" class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">N¬∫ printers</th>
            <th scope="col">Printers</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Table body -->
        </tbody>
      </table>
      <div class="row">
        <div class="col-auto">
          <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#addGroupModal"
            data-toggle="tooltip" data-placement="top" title="add group">
            ‚ûï
          </button>
        </div>
      </div>
    </div>
    <div class="modal fade" id="addGroupModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add group</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="addPrinter">
              <div class="form-row">
                <div class="form-group col-12">
                  <input type="text" class="form-control" id="inputName" placeholder="Name">
                </div>
                <div class="form-group col-12">
                  <input type="text" class="form-control" id="inputPrinters" placeholder="Printers (P001, P002, ...)">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary">Add</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ##################################### JOBS ##################################### -->
    <div class="tab-pane fade" id="jobs" role="tabpanel" aria-labelledby="jobs-tab">
      <div class="d-flex justify-content-center">
        <h1>Jobs</h1>
      </div>
      <form class="filterBy">
        <label>Filter by: </label>
        <div class="form-row">
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputJob" placeholder="Job">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputStatus" placeholder=Status>
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputUserOwner" placeholder="User owner">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputFile" placeholder="File">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputGroupAsigned" placeholder="Group asigned">
          </div>
          <div class="form-group col-md-1">
            <input type="text" class="form-control" id="inputPrinters" placeholder="Printer asigned">
          </div>
          <div class="form-group col-md-1">
            <button type="button" class="btn btn-primary">üîç</button>
          </div>
        </div>
      </form>
      <table id="jobsTable" class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Job</th>
            <th scope="col">Status</th>
            <th scope="col">User owner</th>
            <th scope="col">File</th>
            <th scope="col">Printer asigned</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <div class="modal fade" id="deleteModalJob" tabindex="-1" aria-labelledby="deleteModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Delete job</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  Are you sure you want to delete this job?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary">Delete</button>
                </div>
              </div>
            </div>
          </div>
        </tbody>
      </table>
      <div class="row">
        <div class="col-auto">
          <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#addJobModal"
            data-toggle="tooltip" data-placement="top" title="add job">
            ‚ûï
          </button>
        </div>
      </div>
    </div>
    <div class="modal fade" id="addJobModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add job</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="addPrinter">
              <div class="form-row">
                <div class="form-group col-12">
                  <input type="text" class="form-control" id="inputUaerOwner" placeholder="User owner">
                </div>
                <div class="form-group col-12">
                  <div class="custom-file">
                    <input type="file" class="custom-file-input" id="inputGroupFile01"
                      aria-describedby="inputGroupFileAddon01">
                    <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
                  </div>
                </div>
                <div class="form-group col-12 d-flex justify-content-center">
                  <select class="custom-select" id="inputGroupAsigned">
                    <option value="0">Group asigned</option>
                    <option value="1">G001</option>
                    <option value="2">G002</option>
                  </select>
                  <span class="or"> or </span>
                  <select class="custom-select" id="inputGroupAsigned">
                    <option value="0">Printer asigned</option>
                    <option value="1">P001</option>
                    <option value="2">P002</option>
                    <option value="3">P003</option>
                    <option value="4">P004</option>
                    <option value="5">P005</option>
                  </select>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary">Add</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
  </div>

  <!-- ##################################### SCRIPTS ##################################### -->
  <!-- JavaScript -->
  <!-- jQuery primero, Bootstrap despu√©s -->
  <script src="js/jquery-3.3.1.js"></script>
  <script src="js/bootstrap.bundle.js"></script>
  <script src="js/pmgr.js" type="module"></script>
  <script>
    /* TODO: pasar a pmgr.js*/
    let aux;
    let printers = [
      {
        "id": 0,
        "name": "P001",
        "model": "HP Officejet 3833",
        "status": {
          "type": "printing...",
          "style": "success"
        },
        "group": "G001",
        "ip": "127.0.0.21",
        "location": "location1"
      },
      {
        "id": 1,
        "name": "P002",
        "model": "Canon Pixma iX6850",
        "status": {
          "type": "warning",
          "style": "warning"
        },
        "group": "G002",
        "ip": "127.0.0.22",
        "location": "location2"
      },
      {
        "id": 2,
        "name": "P003",
        "model": "HP Deskjet 3639",
        "status": {
          "type": "pause",
          "style": "info"
        },
        "group": "G002",
        "ip": "127.0.0.23",
        "location": "location3"
      },
      {
        "id": 3,
        "name": "P004",
        "model": "HP Deskjet 3021",
        "status": {
          "type": "warning",
          "style": "warning"
        },
        "group": "G003",
        "ip": "127.0.0.24",
        "location": "location4"
      },
      {
        "id": 4,
        "name": "P005",
        "model": "HP Officejet 3833",
        "status": {
          "type": "printing...",
          "style": "success"
        },
        "group": "G001",
        "ip": "127.0.0.25",
        "location": "location5"
      },
    ];

    let groups = [
      {
        "id": 1,
        "name": "G001",
        "printers": [
          1, 2
        ],
      },
      {
        "id": 2,
        "name": "G002",
        "printers": [
          3, 4
        ],
      },
    ];

    let jobs = [
      {
        "id": 1,
        "name": "J001",
        "owner": "Pablo",
        "file": "file.pdf",
        "status": {
          "type": "printing...",
          "style": "success",
          "ink": 100,
        },
        "pId": "P001",
      },
      {
        "id": 2,
        "name": "J002",
        "owner": "Mariana",
        "file": "iu.pdf",
        "status": {
          "type": "warning",
          "style": "warning",
          "ink": 60,
        },
        "pId": "P004",
      },
      {
        "id": 3,
        "name": "J003",
        "owner": "Jose",
        "file": "file2.pdf",
        "status": {
          "type": "printing...",
          "style": "success",
          "ink": 20,
        },
        "pId": "P001",
      },
      {
        "id": 4,
        "name": "J004",
        "owner": "Efran",
        "file": "file5.pdf",
        "status": {
          "type": "printing...",
          "style": "success",
          "ink": 40,
        },
        "pId": "P002",
      },
      {
        "id": 5,
        "name": "J005",
        "owner": "Pablo",
        "file": "manual.pdf",
        "status": {
          "type": "warning",
          "style": "warning",
          "ink": 10,
        },
        "pId": "P001",
      },
    ];

    /* ##################################### PRINTER FUNCTIONS ##################################### */
    function showPrinters() {
      $("#printersTable").empty();
      $("#printersTable").append(`
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Model</th>
            <th scope="col">Status</th>
            <th scope="col">Group</th>
            <th scope="col">IP</th>
            <th scope="col">Location</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
      `),
      printers.forEach((printer, i) =>
        $("#printersTable").append(`
          <tr id=${printer.id}>
            <th scope="row">${printer.id}</th>
            <td>
              <a class="btn btn-link" data-toggle="collapse" href="#collapse${printer.name}" role="button" aria-expanded="false"
                aria-controls="collapseExample">
                ${printer.name}
              </a>
              <div class="collapse" id="collapse${printer.name}">
                Ink status:
                <div class="progress">
                  <div class="progress-bar bg-success" role="progressbar" style="width:${printer.status.ink}%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </td>
            <td>${printer.model}</td>
            <td>
              <h5><span class="badge badge-${printer.status.style}">${printer.status.type}</span></h5>
            </td>
            <td>${printer.group}</td>
            <td>${printer.ip}</td>
            <td>${printer.location}</td>
            <td>
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editPrinterModal${printer.id}" data-toggle="tooltip" title="edit printer">
                ‚úèÔ∏è
              </button>
              <div class="modal fade" id="editPrinterModal${printer.id}" tabindex="-1" aria-labelledby="editModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Edit printer ${printer.name}</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div id="edit-printer" class="modal-body">
                      <form>
                        <div class="form-row">
                          <div class="form-group col-12">
                            <input type="text" class="form-control" name="input-name" value="${printer.name}" placeholder="Name">
                          </div>
                          <div class="form-group col-12">
                            <input type="text" class="form-control" name="input-model" value="${printer.model}" placeholder="Model">
                          </div>
                          <div class="form-group col-12">
                            <input type="text" class="form-control" name="input-status" value="${printer.status.type}" placeholder="Status">
                          </div>
                          <div class="form-group col-12">
                            <input type="text" class="form-control" name="input-group" value="${printer.group}" placeholder="Group">
                          </div>
                          <div class="form-group col-12">
                            <input type="text" class="form-control" name="input-ip" value="${printer.ip}" placeholder="IP">
                          </div>
                          <div class="form-group col-12">
                            <input type="text" class="form-control" name="input-location" value="${printer.location}" placeholder="Location">
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                      <button type="button" onclick="editPrinter(${printer.id}) "class="btn btn-primary">Edit</button>
                    </div>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-primary remove-printer" data-toggle="modal" data-target="#deletePrinterModal${printer.id}" data-toggle="tooltip" title="delete printer">
                üóëÔ∏è
              </button>
              <div class="modal fade" id="deletePrinterModal${printer.id}" tabindex="-1" aria-labelledby="deleteModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Delete printer ${printer.name}</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      Are you sure you want to delete printer ${printer.name}?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                      <button type="button" id="deletePrinter" onclick="removePrinter(${printer.id})" class="btn btn-danger">Delete</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `),
        $("#printersTable").append(`</tbody>`)
      );
    }

    function addPrinter() {
      /* TODO: mostrar cambios en tabla*/
      let printer = {
        "id": null,
        "name": "",
        "model": "",
        "status": {
          "type": "pause",
          "style": "info"
        },
        "group": "",
        "ip": "",
        "location": "",
      }

      printer.id = (printers[printers.length - 1].id) + 1;
      printer.name = $('.modal-body').find('input[name="printer-name"]').val();
      printer.model = $('.modal-body').find('input[name="printer-model"]').val();
      printer.group = $('.modal-body').find('input[name="printer-group"]').val();
      printer.ip = $('.modal-body').find('input[name="printer-ip"]').val();
      printer.location = $('.modal-body').find('input[name="printer-location"]').val();

      printers.push(printer);
      showPrinters();
      restartModalAddPrinter();
      console.log(printers);
    }

    function restartModalAddPrinter() {
      $('.modal-body').find('input[name="printer-name"]').val("");
      $('.modal-body').find('input[name="printer-model"]').val("");
      $('.modal-body').find('input[name="printer-group"]').val("");
      $('.modal-body').find('input[name="printer-ip"]').val("");
      $('.modal-body').find('input[name="printer-location"]').val("");
    }

    function editPrinter(index) {
      /* TODO: arreglar fallo edit y mostrar cambios en tabla*/
      printers[index].name = $('#edit-printer').find('input[name="input-name"]').val();
      printers[index].model = $('#edit-printer').find('input[name="input-model"]').val();
      printers[index].group = $('#edit-printer').find('input[name="input-group"]').val();
      printers[index].ip = $('#edit-printer').find('input[name="input-ip"]').val();
      printers[index].location = $('#edit-printer').find('input[name="input-location"]').val();

      showPrinters();
      console.log(printers);
    }

    function removePrinter(index) {
      printers.splice(index, 1);
      showPrinters();
      console.log(printers);
    }

    /* ##################################### GROUP FUNCTIONS ##################################### */
    function showGroups() {
      groups.forEach((group, i) =>
        $("#groupsTable").append(`
        <tr>
          <th scope="row">${group.id}</th>
          <td>${group.name}</td>
          <td>${group.printers.length}</td>
          <td>P001, P002</td>
          <td>
            <button type="button" class="btn btn-primary" data-toggle="tooltip" title="edit group">
              ‚úèÔ∏è
            </button>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#deleteModalGroup" data-toggle="tooltip" title="delete group">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      `)
      );
    }

    /* ##################################### JOB FUNCTIONS ##################################### */
    function showJobs() {
      jobs.forEach(job =>
        $("#jobsTable").append(`
        <tr>
          <th scope="row">${job.id}</th>
          <td>${job.name}</td>
          <td>
            <h5><span class="badge badge-${job.status.style}">${job.status.type}</span></h5>
          </td>
          <td>${job.owner}</td>
          <td>${job.file}</td>
          <td>${job.pId}</td>
          <td>
            <button type="button" class="btn btn-primary" data-toggle="tooltip" title="edit job">
              ‚úèÔ∏è
            </button>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#deleteModalJob" data-toggle="tooltip" title="delete job">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      `)
      );
    }

    $(function () {
      showPrinters();
      showJobs();
      showGroups();
    });

  </script>
  <script>
  </script>
</body>

</html>